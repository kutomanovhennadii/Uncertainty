2. Epic 2 — Core Contract

Цель: зафиксировать стабильный минимальный контракт ядра неопределённых чисел (имя типа, структура данных, модель неопределённости, фабрики, правила преобразований и сравнений).
Гейт после эпика: согласованный и документированный API-контракт, на котором можно безопасно строить Geometry/Kalman/Rotations без риска менять фундамент.

2.1. Story 2.1 — Имя и структура типа (UDouble/UScalar)

Смысл: выбрать финальное имя типа и минимальный набор свойств, которые будут стабильны во всех языках и пакетах.

Скоуп:
финальное имя типа (UDouble, UScalar, UncertainScalar — выбираем одно);
состав и имена свойств: Mean, Variance, StdDev;
поведение: immutability, readonly vs sealed;
возможные алиасы, если они допустимы (Value, μ, σ²).

Выходные артефакты:
раздел в docs/core-contract.md: “Final Type Identity”.
утверждённый список публичных свойств и их смыслов.

Acceptance Criteria:
имя выбрано и обосновано документом;
свойства зафиксированы;
нет открытых вопросов по структуре типа;
будущие сторисы не требуют менять структуру.

DoD:
документ обновлён;
принятое имя используется в дальнейших сторисах;
структура совместима с переносом на другие языки.

Tasks:
T2.1.1 — Проанализировать варианты имени и выбрать финальное.
T2.1.2 — Зафиксировать набор свойств и поведение immutable.
T2.1.3 — Добавить описание в docs/core-contract.md.

2.2. Story 2.2 — Фабрики и правила создания экземпляров
Смысл: определить, как создаётся неопределённое число, какие фабрики обязательны, и как обрабатываются числовые типы.

Скоуп:
конструкторы: FromMeanVariance, FromMeanStdDev;
фабрики из double/float с учётом ошибок округления;
политика по умолчанию для UDouble x = 5;
отказ от скрытой магии в пользу явных фабрик.

Выходные артефакты:
раздел “Factories” в docs/core-contract.md;
таблица допустимых фабрик.

Acceptance Criteria:
определён набор фабрик;
описано, как трактуется “простой double”;
документ содержит таблицу фабрик;
фабрики непротиворечивы математической модели.

DoD:
документ зафиксирован;
нет разночтений между фабриками и полями ядра.

Tasks:
T2.2.1 — Определить поведение double → UDouble.
T2.2.2 — Зафиксировать фабрики и их сигнатуры.
T2.2.3 — Добавить в документ описание и таблицу.

2.3. Story 2.3 — Политика преобразований и сравнений
Смысл: определить стабильные правила сравнения и преобразования, чтобы не менять их после реализации.

Скоуп:
implicit/explicit правила для double/float;
строгие сравнения <, >;
равенство: через диапазон, через ε, или запрет ==;
недопустимые преобразования.

Выходные артефакты:
раздел “Conversions & Comparisons” в docs/core-contract.md.

Acceptance Criteria:
определено, какие преобразования разрешены;
правила сравнения однозначны;
документ содержит примеры;
политика согласована с математической моделью.

DoD:
документ зафиксирован;
правила не конфликтуют с фабриками.

Tasks:
T2.3.1 — Определить стратегию равенства (диапазон/ε).
T2.3.2 — Определить implicit/explicit правила.
T2.3.3 — Описать кейсы NaN/Infinity.
T2.3.4 — Внести всё в документ.

2.4. Story 2.4 — Математическая модель неопределённости
Смысл: зафиксировать фундаментальные допущения, чтобы дальнейшие компоненты не меняли интерпретацию Variance/StdDev.

Скоуп:
нормальность распределений или приближение;
независимость ошибок при бинарных операциях;
линейная пропагация (через производные);
ограничения модели (мало подходит для далеких нелинейностей).

Выходные артефакты:
документ docs/core-model.md.

Acceptance Criteria:
модель описана однозначно;
допущения перечислены;
документ синхронизирован с фабриками и правилами преобразований.

DoD:
документ полностью оформлен;
нет противоречий в определениях Mean/Variance.

Tasks:
T2.4.1 — Описать допущение нормальности.
T2.4.2 — Описать независимость ошибкок.
T2.4.3 — Описать линейную пропагацию.
T2.4.4 — Добавить ограничения модели.
T2.4.5 — Собрать всё в docs/core-model.md.

2.5. Story 2.5 — Заморозка публичного API (Core Signatures)
Смысл: создать документ, который фиксирует будущие публичные сигнатуры ядра перед реализацией.

Скоуп:
публичное имя типа;
свойства;
обязательные фабрики;
набор допустимых операторов;
таблица edge-кейсов.

Выходные артефакты:
docs/core-signatures.md.

Acceptance Criteria:
документ соответствует результатам Stories 2.1–2.4;
содержит финальный, согласованный API;
готов к реализации без уточнений.

DoD:
файл заполнен;
файл согласован с предыдущими документами;
файл будет использован в Epic 3.

Tasks:
T2.5.1 — Сформировать итоговое имя типа и свойства.
T2.5.2 — Добавить список фабрик.
T2.5.3 — Добавить таблицу операторов.
T2.5.4 — Добавить edge-cases.
T2.5.5 — Сформировать итоговый документ.

2.6. Gate: Core Contract Ready
Условия прохождения:
написаны и согласованы core-model.md, core-contract.md, core-signatures.md;
структура типа, фабрики и поведение неизменны;
переход к Epic 3 (Core Implementation) не требует пересмотра решения;
все спорные вопросы по поведению типа закрыты в документах.
