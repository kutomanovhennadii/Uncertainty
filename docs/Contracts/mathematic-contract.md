# Mathematical Contract — UDouble Core Model

## 1. Общая формулировка модели
Тип UDouble представляет скалярную величину с малой случайной ошибкой, описываемой параметрами Mean и Variance. Модель основана на локальной гауссовости и линейной пропагации неопределённости первого порядка (разложение Тейлора). UDouble не является вероятностным распределением в полном смысле; он отражает локальное поведение функций при малых ошибках и используется для инженерных расчётов чувствительности и устойчивости.

## 2. Допущение нормальности
Ошибка трактуется как локально нормальная, то есть распределение вокруг Mean аппроксимируется одной точкой и дисперсией. Нормальность понимается не как глобальная характеристика функции, а как локальная аппроксимация малой погрешности:
Var(f(x)) ≈ (f′(x))² Var(x)
Это соответствует модели 2: normal small-error approximation. Ее задача — давать корректную пропагацию вблизи Mean, без попыток описывать форму распределения при больших нелинейностях или больших ошибках.

## 3. Допущение независимости
Все ошибки считаются независимыми. При бинарных операциях нет учёта ковариаций:
Var(f(x, y)) ≈ (df/dx)² Var(x) + (df/dy)² Var(y)
Внутри UDouble не хранится история вычислений, не отслеживаются зависимые источники ошибки, не существует механизма covariance. Векторные типы более высокого уровня (например, UVector или матрицы неопределённости) смогут поддерживать ковариации отдельно, но UDouble остаётся атомарной моделью, содержащей только Mean и Variance.

## 4. Линейная пропагация с инженерными поправками
Основное правило вычисления дисперсии:
Var(f(x)) = (f′(x))² Var(x)
Однако чистая линейная модель неустойчива вблизи особых точек функций. Для повышения численной устойчивости допускаются инженерные поправки в следующих случаях.

### 4.1 Малые аргументы
Функции sin, cos, tan, asin, acos и аналогичные заменяются локальными аппроксимациями для Mean и корректировками Var, когда прямое вычисление производной приводит к потере точности. Это позволяет избежать ошибок округления при |x| → 0 и сохранить адекватность дисперсии.

### 4.2 Пограничные значения
Функции, имеющие ограничения области определения (log, sqrt, деление, atan2), должны обрабатывать случаи, когда производная или знаменатель стремятся к нулю. Если значение допустимо математически, но линейная формула выдаёт чрезмерно большую дисперсию, применяется стабильностная коррекция.

### 4.3 Ограничение роста дисперсии
Если вычисленная дисперсия выходит за допустимые численные пределы, она насыщается до максимально корректного значения вместо того, чтобы генерировать исключение или производить NaN. Saturation выполняется по правилам:
1. Mean вычисляется строго по определению функции.
2. Var принимается равным min(Var_computed, Var_max), где Var_max является безопасным верхним пределом для системы.
Это обеспечивает устойчивость расчётов при работе с чувствительными функциями без нарушения математического смысла модели.

## 5. Ошибки области определения
Если входное значение выходит за математически допустимую область (например x ≤ 0 для log(x) или sqrt(x)), операция должна завершиться исключением. Такие ошибки относятся к категории input domain violation и не являются частью модели неопределённости. Saturation применяется только тогда, когда значение допустимо, но производная или вычисления неустойчивы.

## 6. Ограничения модели
1. Модель корректна только для малых ошибок; при больших вариациях линейная аппроксимация теряет смысл.
2. Нелинейные эффекты второго и выше порядка не учитываются.
3. Отсутствие ковариаций делает модель не пригодной для задач, требующих учёта зависимых источников ошибок на уровне скаляров.
4. Модель предназначена для инженерных расчётов, а не для вероятностного вывода или статистической оценки сложных распределений.

## 7. Итог
UDouble — это минимальная и переносимая модель малых нормальных ошибок с устойчивой линейной пропагацией. Тип предназначен для использования в инженерных системах, численных вычислениях, геометрических трансформациях и последующем расширении до векторных структур ошибок. Математические допущения фиксированы и стабильны для различных реализаций библиотеки на разных языках.
