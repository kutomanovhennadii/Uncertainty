# Core Contract: UDouble (Uncertainty Double)

Этот документ фиксирует минимальное и неизменяемое ядро библиотеки неопределённостей.
Все компоненты уровней Geometry, Angle, Rotation, Kalman и будущие расширения обязаны
строиться на этих гарантиях и не нарушать их.

Документ представляет собой жёсткий контракт, который сохраняется между версиями и
обеспечивает переносимость API на другие языки программирования.

-------------------------------------------------------------------------------

## 1. Назначение типа

UDouble — скалярное числовое значение с гауссовской неопределённостью.
Содержит:
- математическое ожидание Mean
- дисперсию Variance
- стандартное отклонение StdDev, вычисляемое как sqrt(Variance)

UDouble ведёт себя как обычное число, но распространяет неопределённость
при арифметических операциях.

-------------------------------------------------------------------------------

## 2. Структура и свойства

### 2.1 Имя типа

UDouble (фиксировано и используется во всех языках/пакетах).

### 2.2 Публичные свойства (финальный набор)

public double Mean     { get; }
public double Variance { get; }
public double StdDev   => Math.Sqrt(Variance);

Алиасы (Value, μ, σ, σ²) не используются.

### 2.3 Изменяемость

Тип является immutable:

public readonly struct UDouble

Гарантии:
- после создания объект не меняет своего состояния;
- все операции возвращают новый экземпляр UDouble;
- нет сеттеров Mean/Variance.

-------------------------------------------------------------------------------

## 3. Конструкторы

Минимальный набор:

public UDouble(double mean, double variance)

Требования:
- variance >= 0
- отрицательная дисперсия вызывает ArgumentOutOfRangeException
- StdDev всегда вычисляется динамически как sqrt(variance)

-------------------------------------------------------------------------------

## 4. Математические допущения

1. Распределение является гауссовским.
2. Ошибки считаются независимыми.
3. Пропагация ошибки выполняется через первую производную
   или её аппроксимацию (линейная пропагация).

Эти правила обязательны для переносимости поведения между языками.

-------------------------------------------------------------------------------

## 5. Поведение и ограничения

### 5.1 Допустимые значения

Допускается:
- любое конечное число Mean
- Variance >= 0

Не допускается:
- отрицательная Variance
- NaN или Infinity в Variance

### 5.2 Стандартное отклонение

StdDev вычисляется как sqrt(Variance) и не хранится.

### 5.3 Сравнения

Базовое сравнение выполняется по Mean:

a > b означает a.Mean > b.Mean

Расширенные сравнения с учётом неопределённости не входят в контракт ядра.

-------------------------------------------------------------------------------

## 6. Гарантии стабильности API

Все перечисленные свойства, имена и семантика являются финальными.
Они не могут быть изменены в несовместимых версиях.
Расширения обязаны соблюдать контракт и не менять модель данных.

-------------------------------------------------------------------------------

## 7. Ошибки и исключения

- отрицательная дисперсия → ArgumentOutOfRangeException
- NaN или Infinity в параметрах конструктора → ArgumentException
- математические функции обязаны корректно работать с Variance = 0

-------------------------------------------------------------------------------

## 8. Минимальный эталон типа

Пример структуры (не является реализацией, а фиксирует форму):

public readonly struct UDouble
{
    public double Mean     { get; }
    public double Variance { get; }
    public double StdDev   => Math.Sqrt(Variance);

    public UDouble(double mean, double variance)
    {
        if (variance < 0 || double.IsNaN(variance))
            throw new ArgumentOutOfRangeException(nameof(variance));

        Mean     = mean;
        Variance = variance;
    }
}

Эта структура является минимальным контрактом ядра.

-------------------------------------------------------------------------------
